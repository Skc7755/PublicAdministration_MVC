
@{
    ViewData["Title"] = "用章管理详情";
}

<h1></h1>

<script src="~/lib/jquery/dist/jquery.js"></script>
<script src="~/lib/layui-v2.5.6/layui/layui.js"></script>
<link href="~/lib/layui-v2.5.6/layui/css/layui.css" rel="stylesheet" />

<div>
    <button type="button" class="layui-btn layui-btn-primary" style="margin-left:910px;" onclick="Fh()">
        <i class="layui-icon">&#xe65c;</i> 返回
    </button>
    <button type="button" class="layui-btn layui-btn-primary" onclick="FanTian()">
        <i class="layui-icon">&#xe9aa;</i> 刷新
    </button>
</div>
<br />
<h2 style="background-color:cornsilk">基本信息</h2>
<table class="table table-bordered">
    <tr>
        <td class="text-center">主题</td>
        <td>
            <input class="form-control" id="txt_Matter" type="text" />
        </td>
    </tr>
    <tr>
        <td class="text-center">结束时间</td>
        <td>
            <input class="form-control" id="txt_EndTime" type="text" />
        </td>
    </tr>
</table>
<h2 style="background-color:cornsilk">申请信息</h2>
<table class="table table-bordered">
    <tr>
        <td class="text-center">申请人</td>
        <td>
            <select class="form-control" id="txt_Sqr">
                <option value="-1">--请选择--</option>
            </select>
        </td>
        <td class="text-center">所属部门</td>
        <td>
            <select class="form-control" id="txt_Bm">
                <option value="-1">--请选择--</option>
            </select>
        </td>
    </tr>
    <tr>
        <td class="text-center">申请时间</td>
        <td>
            <input class="form-control" id="txt_ApplicationTime" type="text" />
        </td>
        <td class="text-center">印章名称</td>
        <td>
            <select class="form-control" id="txt_Yz">
                <option value="-1">--请选择--</option>
            </select>
        </td>
    </tr>
    <tr>
        <td class="text-center">事由及用途</td>
        <td colspan="3">
            <textarea class="form-control" id="txt_Purpose" rows="2" cols="20"></textarea>
        </td>
    </tr>
    <tr>
        <td class="text-center">用印文件名</td>
        <td>
            <input class="form-control" id="txt_File" type="text" />
        </td>
        <td class="text-center">用印份数</td>
        <td>
            <input class="form-control" id="txt_Used" type="text" />
        </td>
    </tr>
    <tr>
        <td class="text-center">预借时间</td>
        <td>
            <input class="form-control" id="txt_AdvanceTime" type="text" />
        </td>
        <td class="text-center">归还时间</td>
        <td>
            <input class="form-control" id="txt_ReturenTime" type="text" />
        </td>
    </tr>
    <tr>
        <td class="text-center">实际归还信息</td>
        <td colspan="3">
            <textarea class="form-control" id="txt_Information" rows="2" cols="20"></textarea>
        </td>
    </tr>
    <tr>
        <td class="text-center">附件</td>
        <td>
            <input id="File1" type="file" />
        </td>
    </tr>
</table>

<script>

    $(function () {
        var id = window.location.href.split("id")[1].split("=")[1];
        console.log(decodeURI(id));
        GetApplicant();//获取申请人的下拉绑定
        GetDepartment();//获取部门的下拉绑定
        GetSealName();//获取印章名称下拉绑定
        FanTian(id);
    })
    //申请人下拉框
    function GetApplicant() {
        $.ajax({
            async: false,
            url: 'http://localhost:57726/api/default/GetApplicants',
            dataType: "json",
            type: "get",
            success: function (d) {
                $(d).each(function () {
                    $("#txt_Sqr").append("<option value='" + this.aId + "'>" + this.aName + "</option>");
                })
            }
        })
    }
    //部门下拉框
    function GetDepartment() {
        $.ajax({
            async: false,
            url: 'http://localhost:57726/api/default/GetDepartments',
            dataType: "json",
            type: "get",
            success: function (d) {
                $(d).each(function () {
                    $("#txt_Bm").append("<option value='" + this.dId + "'>" + this.dName + "</option>");
                })
            }
        })
    }
    //印章名称下拉框
    function GetSealName() {
        $.ajax({
            async: false,
            url: 'http://localhost:57726/api/default/GetSealNames',
            dataType: "json",
            type: "get",
            success: function (d) {
                $(d).each(function () {
                    $("#txt_Yz").append("<option value='" + this.sN_Id + "'>" + this.sN_Name + "</option>");
                })
            }
        })
    }
    //用章管理反填数据表单
    function FanTian(id) {
        $.ajax({
            async: false,
            url: "http://localhost:57726/api/default/ByParticulars",
            type: "get",
            dataType: "json",
            data: { byId: id },
            success: function (d) {

                $("#txt_Matter").val(d.b_Matter);
                $("#txt_EndTime").val(d.b_EndTime);
                $("#txt_Sqr option").each(function () {
                    if (this.value == d.a_Id) {
                        $(this).prop("selected", "selected");
                    }
                })
                $("#txt_Bm option").each(function () {
                    if (this.value == d.d_Id) {
                        $(this).prop("selected", "selected");
                    }
                })
                $("#txt_Yz option").each(function () {
                    if (this.value == d.sN_Id) {
                        $(this).prop("selected", "selected");
                    }
                })
                $("#txt_ApplicationTime").val(d.b_ApplicationTime);
                $("#txt_Purpose").val(d.b_Purpose);
                $("#txt_File").val(d.b_File);
                $("#txt_Used").val(d.b_Used);
                $("#txt_AdvanceTime").val(d.b_AdvanceTime);
                $("#txt_ReturenTime").val(d.b_ReturenTime);
                $("#txt_Information").val(d.b_Information);
            }
        })
    }

    //返回列表
    function Fh() {
        location.href = "/Stamp/Show";
    }
</script>
